<app-topbar></app-topbar>
<app-sidenav></app-sidenav>
<main id="main">
    <mat-progress-bar class="page-loader" color="accent" mode="indeterminate" *ngIf="loading"></mat-progress-bar>
    <div id="dashboard-cards">
        <div fxLayout="row">
            <div fxFlex="0 1 25%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Total Revenue</h4>
                    <p class="dashboard-card-value">
                        <mat-icon color="primary">inbox</mat-icon> {{totalSale | currency: storeCurrency + ' '}}
                    </p>
                </mat-card>
            </div>
            <div fxFlex="0 1 25%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Net Sales</h4>
                    <p class="dashboard-card-value">
                        <mat-icon color="primary">payments</mat-icon> {{netSale | currency: storeCurrency + ' '}}
                    </p>
                </mat-card>
            </div>
            <div fxFlex="0 1 25%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Inventory Size</h4>
                    <p class="dashboard-card-value">
                        <mat-icon color="primary">inbox</mat-icon> {{inventorySize}}
                    </p>
                </mat-card>
            </div>

            <div fxFlex="0 1 25%">
                <mat-card>
                    <div fxLayout="row">
                        <div fxFlex="0 1 50%">
                            <mat-form-field class="date-filter" appearance="outline">
                                <mat-label>start date</mat-label>
                                <input type="date" (change)="dateFilter()" [(ngModel)]="start_date" matInput />
                            </mat-form-field>
                        </div>

                        <div fxFlex="0 1 50%">
                            <mat-form-field class="date-filter" appearance="outline">
                                <mat-label>end date</mat-label>
                                <input type="date" (change)="dateFilter()" [(ngModel)]="end_date" matInput />
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card>
            </div>
        </div>

        <div class="card-row" fxLayout="row">
            <div fxFlex="0 1 25%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Basket Analysis</h4>
                    <div fxLayoutAlign="space-between" fxLayout="row">
                        <div fxLayout="column">
                            <h4 class="card-value">{{average_basket_size}}</h4>
                            <p class="card-text">Avg Basket size</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{average_basket_value}}</h4>
                            <p class="card-text">Avg Basket Value</p>
                        </div>
                    </div>
                </mat-card>
            </div>

            <div fxFlex="0 1 75%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Order Analysis</h4>
                    <div fxLayoutAlign="space-between" fxLayout="row">
                        <div fxLayout="column">
                            <h4 class="card-value">{{total_orders}}</h4>
                            <p class="card-text">Total Orders</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{canceled_orders_count}}</h4>
                            <p class="card-text">Total Cancelled</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{returned_orders_count}}</h4>
                            <p class="card-text">Total Returned</p>
                        </div>
                    </div>
                </mat-card>
            </div>

            <div *ngIf="!is_vendor" fxFlex="0 1 25%">
                <mat-card>
                    <mat-form-field class="vendor-field" appearance="outline">
                        <mat-label>Vendor</mat-label>
                        <mat-select [value]="defaultSelected" (selectionChange)="onVendorChange($event)">
                            <mat-option [value]="defaultSelected">All</mat-option>
                            <mat-option [value]="vendor.id" *ngFor="let vendor of vendors">{{vendor.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </mat-card>
            </div>
        </div>
        <div class="card-row" fxLayout="row">
            <div fxFlex="0 1 50%">
                <mat-card>
                    <h4 fxLayoutAlign="center">General Analysis</h4>
                    <div fxLayoutAlign="space-between" fxLayout="row">
                        <div *ngIf="!is_vendor" fxLayout="column">
                            <h4 class="card-value">{{total_vendor_count}}</h4>
                            <p class="card-text">Total Vendors</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{total_collections_count}}</h4>
                            <p class="card-text">Total Collections</p>
                        </div>


                        <div fxLayout="column">
                            <h4 class="card-value">{{total_product_group_count}}</h4>
                            <p class="card-text">Total Product Groups</p>
                        </div>
                    </div>
                </mat-card>
            </div>

            <div fxFlex="0 1 50%">
                <mat-card>
                    <h4 fxLayoutAlign="center">Product Analysis</h4>
                    <div fxLayoutAlign="space-between" fxLayout="row">
                        <div fxLayout="column">
                            <h4 class="card-value">{{total_products_count}}</h4>
                            <p class="card-text">Total Products</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{total_active_products_count}}</h4>
                            <p class="card-text">Total Active Products</p>
                        </div>

                        <div fxLayout="column">
                            <h4 class="card-value">{{total_inactive_products_count}}</h4>
                            <p class="card-text">Total Unactive Products</p>
                        </div>
                    </div>
                </mat-card>
            </div>
        </div>

        <div class="card-row" fxLayout="row">
            <div #containerRef fxFlex="0 1 50%">
                <mat-card fxFlex="0 1 100%">
                    <div #containerRef>
                        <h4 fxLayoutAlign="center">Top 10 Sold Items</h4>
                        <ngx-charts-pie-chart [results]="topSolditems" [scheme]="'ocean'"
                            [legendTitle]="'Product Sale Report'"  [view]="[containerRef.offsetWidth , 300]"
                            [gradient]="false" [labels]="true">
                        </ngx-charts-pie-chart>
                    </div>
                </mat-card>

            </div>
            <div fxFlex="0 1 50%">
                <mat-card fxFlex="0 1 100%">
                    <div #containerRef2>
                        <h4 fxLayoutAlign="center">User by Countries</h4>
                        <ngx-charts-bar-vertical [view]="[containerRef2.offsetWidth, 300]" [results]="saleByCity"
                            [scheme]="'ocean'" [legendTitle]="'Product Sale Chart'" [xAxis]="true" [yAxis]="true"
                            [gradient]="false">
                        </ngx-charts-bar-vertical>
                    </div>

                </mat-card>

            </div>
        </div>

        <div class="card-row" fxLayout="row">
            <div #containerRef fxFlex="0 1 50%">
                <mat-card fxFlex="0 1 100%">
                    <div #containerRef3>
                        <h4 fxLayoutAlign="center">Total Order by Category name</h4>
                        <ngx-charts-bar-horizontal [view]="[containerRef3.offsetWidth , 400]" [results]="saleData"
                            [scheme]="'ocean'" [xAxisLabel]="'Products'" [legendTitle]="'Product Sale Chart'"
                            [yAxisLabel]="'Sale'" [xAxis]="true" [yAxis]="true" [gradient]="false">
                        </ngx-charts-bar-horizontal>
                    </div>
                </mat-card>
            </div>

            <div fxFlex="0 1 50%">
                <mat-card fxFlex="0 1 100%">
                    <div #containerRef4>
                        <h4 fxLayoutAlign="center">Total Sales by date</h4>
                        <ngx-charts-line-chart [view]="[containerRef4.offsetWidth , 400]" [results]="lineData"
                            [scheme]="'ocean'" [xAxisLabel]="'Products'" [legendTitle]="'Product Sale Chart'"
                            [yAxisLabel]="'Sale'" [xAxis]="true" [yAxis]="true" [gradient]="false">
                        </ngx-charts-line-chart>
                    </div>
                </mat-card>
            </div>
        </div>
    </div>
</main>