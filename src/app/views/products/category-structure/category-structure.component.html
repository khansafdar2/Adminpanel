<app-topbar></app-topbar>
<app-sidenav></app-sidenav>
<main id="main">
    <mat-progress-bar class="page-loader" color="accent" mode="indeterminate" *ngIf="loading"></mat-progress-bar>
    <div class="page-header" fxLayout="row" fxLayoutAlign="space-between center">
        <h1>Category structure</h1>

        <div class="header-actions">
            <a [routerLink]="['/', URLS.categories, URLS.newMainCategory]" mat-flat-button color="primary">Create new</a>
        </div>
    </div>

    <div class="page-container">
        <mat-card class="categories-card">
            <mat-form-field appearance="outline">
                <mat-label>Search</mat-label>
                <input matInput type="search" [formControl]="searchField" name="category" />
            </mat-form-field>

            <div id="category-structure">
                <div class="category-wrapper" *ngFor="let mainCategory of filteredCategories | async; let i = index;">
                    <div class="category-inner" fxLayout="row" fxLayoutAlign="space-between center">
                        <span class="category-title">{{mainCategory.name}}</span>

                        <div class="category-actions">
                            <span class="products-count">13 products</span>
                            <button mat-icon-button color="primary" (click)="addSubCategory(mainCategory.id)">
                                <mat-icon>add</mat-icon>
                            </button>
                            <a [routerLink]="['/', URLS.categories, URLS.editMainCategory, mainCategory.id]" mat-icon-button color="primary">
                                <mat-icon>edit</mat-icon>
                            </a>
                            <button mat-icon-button color="warn">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </div>

                    <div class="sub-categories">
                        <div class="category-inner" fxLayout="row" fxLayoutAlign="space-between center" *ngFor="let subCategory of mainCategory.sub_category">
                            <span class="category-title">{{subCategory.name}}</span>
    
                            <div class="category-actions">
                                <span class="products-count">13 products</span>
                                <a [routerLink]="['/', URLS.categories, URLS.editSubCategory, subCategory.id]" mat-icon-button color="primary">
                                    <mat-icon>edit</mat-icon>
                                </a>
                                <button mat-icon-button color="warn">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </div>

                        <div class="category-inner add-category" fxLayout="row" fxLayoutAlign="space-between center" (click)="addSubCategory(mainCategory.id)">
                            <span class="category-title">+ Add subcategory</span>
                        </div>
                    </div>
                </div>
            </div>
        </mat-card>
    </div>
</main>